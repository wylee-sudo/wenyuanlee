<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QR Code ç”¢ç”Ÿå™¨ | CDR Lab</title>
  <meta name="description" content="å–®ä¸€æª”æ¡ˆçš„ QR Code ç”¢ç”Ÿå™¨ï¼Œæ”¯æ´éŒ¯èª¤ä¿®æ­£ç­‰ç´šã€å°ºå¯¸ã€é‚Šç•Œã€å‰æ™¯/èƒŒæ™¯è‰²ã€PNG èˆ‡ SVG ä¸‹è¼‰ã€‚" />
  <style>
    :root{
      --bg:#0b0c10; --card:#111318; --text:#e6e7eb; --muted:#9aa0a6; --brand:#6ee7b7; --accent:#60a5fa;
      --ring: rgba(96,165,250,.45);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Noto Sans TC,Arial,"Apple Color Emoji","Segoe UI Emoji";background:var(--bg);color:var(--text)}
    .wrap{max-width:1100px;margin:24px auto;padding:16px}
    .grid{display:grid;gap:16px;grid-template-columns:1.2fr .8fr}
    @media (max-width:960px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid #1b1f2a;border-radius:18px;padding:16px 18px;box-shadow:0 6px 30px rgba(0,0,0,.25)}
    .title{font-size:22px;margin:0 0 8px}
    label{display:block;margin:10px 0 6px;color:var(--muted);font-size:14px}
    input[type="text"], textarea, select, input[type="number"]{
      width:100%;padding:10px 12px;border-radius:12px;border:1px solid #252a36;background:#0f1117;color:var(--text);
      outline:none;transition:box-shadow .15s,border-color .15s
    }
    textarea{min-height:120px;resize:vertical}
    input:focus, textarea:focus, select:focus{border-color:var(--accent);box-shadow:0 0 0 4px var(--ring)}
    .row{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    @media (max-width:720px){.row{grid-template-columns:repeat(2,1fr)}}
    button{cursor:pointer;border:1px solid #273246;background:#131a24;color:var(--text);padding:10px 14px;border-radius:12px;font-weight:600}
    button.primary{background:linear-gradient(135deg,var(--accent),#22d3ee);border:none}
    button.ghost{background:transparent;border-color:#2a3142}
    button:focus-visible{outline:3px solid var(--ring)}
    .preview{display:grid;place-items:center;background:#0c0f16;border-radius:16px;border:1px dashed #2a3142;min-height:380px}
    .hint{font-size:13px;color:var(--muted)}
    .footer{opacity:.8;font-size:12px;margin-top:10px;color:var(--muted)}
    .badge{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;background:#10151f;border:1px solid #223049;color:#a6b3c6;font-size:12px}
    .stack{display:flex;flex-wrap:wrap;gap:8px}
    .spacer{height:8px}
  </style>
  <!-- QRCode library loader: try jsDelivr â†’ unpkg. No SRI to avoid CDN hash mismatch on GitHub Pages. -->
  <script>
    (function loadQRCodeLib(){
      function inject(src){
        return new Promise(function(res,rej){
          var s=document.createElement('script'); s.src=src; s.onload=res; s.onerror=rej; document.head.appendChild(s);
        });
      }
      // try jsDelivr first, then unpkg fallback
      inject('https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js')
        .catch(function(){ return inject('https://unpkg.com/qrcode@1.5.3/build/qrcode.min.js'); })
        .catch(function(){ console.error('Failed to load qrcode library from CDNs.'); alert('ç„¡æ³•è¼‰å…¥ QR å‡½å¼åº«ï¼Œè«‹ç¢ºèªç¶²è·¯æˆ–æ”¹ç”¨é›¢ç·šç‰ˆã€‚'); });
    })();
  </script>
  <!-- Google Analytics (replace G-N8QWS5JKZD if needed) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-N8QWS5JKZD"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-N8QWS5JKZD');
  </script>
</head>
<body>
  <div class="wrap">
    <div class="stack" style="justify-content:space-between;align-items:center;margin-bottom:10px">
      <div class="stack" style="align-items:center">
        <span class="badge">QR Code ç”¢ç”Ÿå™¨ Â· å–®æª”ç‰ˆ</span>
      </div>
      <div class="stack">
        <button id="btnSampleCDR" class="ghost" title="å¿«é€Ÿå¸¶å…¥ CDR Lab ç¶²ç«™">CDR Lab ç¯„ä¾‹</button>
        <button id="btnClear" class="ghost">æ¸…ç©º</button>
      </div>
    </div>

    <div class="grid">
      <!-- Left: form -->
      <section class="card">
        <h2 class="title">å…§å®¹</h2>
        <label for="content">è¼¸å…¥è¦ç·¨ç¢¼çš„å…§å®¹ï¼ˆç¶²å€ / æ–‡å­— / vCard / Wiâ€‘Fi ç­‰ï¼‰</label>
        <textarea id="content" placeholder="ä¾‹å¦‚ï¼šhttps://wylee-sudo.github.io/wenyuanlee/"></textarea>
        <div class="spacer"></div>

        <div class="row">
          <div>
            <label for="ecLevel">éŒ¯èª¤ä¿®æ­£</label>
            <select id="ecLevel">
              <option value="L">Lï¼ˆ7%ï¼‰</option>
              <option value="M" selected>Mï¼ˆ15%ï¼‰</option>
              <option value="Q">Qï¼ˆ25%ï¼‰</option>
              <option value="H">Hï¼ˆ30%ï¼‰</option>
            </select>
          </div>
          <div>
            <label for="size">å°ºå¯¸ï¼ˆpxï¼‰</label>
            <input id="size" type="number" min="128" max="2048" step="32" value="512"/>
          </div>
          <div>
            <label for="margin">é‚Šç•Œï¼ˆmodulesï¼‰</label>
            <input id="margin" type="number" min="0" max="16" step="1" value="4"/>
          </div>
          <div>
            <label for="format">æ ¼å¼</label>
            <select id="format">
              <option value="png" selected>PNGï¼ˆä½åœ–ï¼‰</option>
              <option value="svg">SVGï¼ˆå‘é‡ï¼‰</option>
            </select>
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <div>
            <label for="fg">å‰æ™¯è‰²</label>
            <input id="fg" type="text" value="#000000" />
          </div>
          <div>
            <label for="bg">èƒŒæ™¯è‰²</label>
            <input id="bg" type="text" value="#ffffff" />
          </div>
          <div style="display:flex;align-items:flex-end;gap:8px">
            <button id="btnGenerate" class="primary" style="width:100%">ç”Ÿæˆ / æ›´æ–°</button>
          </div>
          <div style="display:flex;align-items:flex-end;gap:8px">
            <button id="btnDownload">ä¸‹è¼‰</button>
          </div>
        </div>

        <details style="margin-top:12px">
          <summary>ğŸ“„ å¿«é€Ÿçµ„åˆæ¨¡æ¿ï¼ˆé»æ“Šå±•é–‹ï¼‰</summary>
          <div style="display:grid;gap:10px;margin-top:10px">
            <div class="row">
              <button class="ghost" id="tplURL">URL ç¯„æœ¬</button>
              <button class="ghost" id="tplVCF">vCard åç‰‡</button>
              <button class="ghost" id="tplWIFI">Wiâ€‘Fi è¨­å®š</button>
              <button class="ghost" id="tplMAIL">Email</button>
            </div>
            <div class="hint">vCard ä¾‹ï¼š<code>BEGIN:VCARD\nVERSION:3.0\nN:Lee;Wen-Yuan;;;\nFN:Wen-Yuan LEE\nORG:CDR Lab\nTITLE:Professor\nEMAIL;TYPE=INTERNET:sample@example.com\nTEL;TYPE=CELL:+886-900-000-000\nURL:https://wylee-sudo.github.io/wenyuanlee/\nEND:VCARD</code></div>
            <div class="hint">Wiâ€‘Fi ä¾‹ï¼š<code>WIFI:T:WPA;S:CDR-Lab;P:your_password;H:false;;</code></div>
          </div>
        </details>
        <p class="footer">å°æé†’ï¼šå‹™å¿…ä¿ç•™è¶³å¤  <em>Quiet Zone</em>ï¼ˆé‚Šç•Œï¼‰ï¼Œä¸¦ä»¥å¯¦æ©Ÿè·é›¢ 20â€“30 cm æ¸¬è©¦æƒæå¯é åº¦ã€‚</p>
      </section>

      <!-- Right: preview -->
      <section class="card">
        <h2 class="title">å³æ™‚é è¦½</h2>
        <div id="preview" class="preview"><div class="hint">æŒ‰ã€Œç”Ÿæˆ / æ›´æ–°ã€ä»¥ç”¢ç”Ÿ QR Code</div></div>
        <p class="hint">å®Œæˆå¾Œå¯æŒ‰ã€Œä¸‹è¼‰ã€è¼¸å‡º PNG æˆ– SVGã€‚</p>
      </section>
    </div>

    <p class="footer">Â© <span id="year"></span> Color & Design Research Lab Â· å–®æª”ç‰ˆï¼ˆå¯ç›´æ¥æ”¾åˆ° GitHub Pagesï¼‰ã€‚</p>
  </div>

  <script>
    const $ = (s) => document.querySelector(s);
    const content = $('#content');
    const ecLevel = $('#ecLevel');
    const size = $('#size');
    const margin = $('#margin');
    const fmt = $('#format');
    const fg = $('#fg');
    const bg = $('#bg');
    const preview = $('#preview');
    const btnGen = $('#btnGenerate');
    const btnDl = $('#btnDownload');

    // helpers
    const YEAR = new Date().getFullYear();
    document.getElementById('year').textContent = YEAR;
    $('#btnSampleCDR').addEventListener('click',()=>{content.value='https://wylee-sudo.github.io/wenyuanlee/';});
    $('#btnClear').addEventListener('click',()=>{content.value='';preview.innerHTML='<div class="hint">å·²æ¸…ç©ºã€‚è«‹è¼¸å…¥å…§å®¹å¾Œå†ç”Ÿæˆã€‚</div>';});

    // Templates
    $('#tplURL').addEventListener('click',()=>{content.value='https://example.com';});
    $('#tplVCF').addEventListener('click',()=>{
      content.value = [
        'BEGIN:VCARD','VERSION:3.0','N:Lee;Wen-Yuan;;;','FN:Wen-Yuan LEE','ORG:CDR Lab','TITLE:Professor',
        'EMAIL;TYPE=INTERNET:sample@example.com','TEL;TYPE=CELL:+886-900-000-000','URL:https://wylee-sudo.github.io/wenyuanlee/','END:VCARD'
      ].join('\n');
    });
    $('#tplWIFI').addEventListener('click',()=>{content.value='WIFI:T:WPA;S:CDR-Lab;P:your_password;H:false;;';});
    $('#tplMAIL').addEventListener('click',()=>{content.value='mailto:sample@example.com?subject=Hello%20CDR%20Lab&body=Hi';});

    let lastBlobURL = null; // for revoking

    async function renderQR(){
      const text = content.value.trim();
      if(!text){
        preview.innerHTML = '<div class="hint">è«‹å…ˆè¼¸å…¥å…§å®¹ã€‚</div>';
        return;
      }
      const opts = {
        errorCorrectionLevel: ecLevel.value,
        margin: Number(margin.value)||0,
        color: { dark: fg.value || '#000000', light: bg.value || '#ffffff' },
        width: Number(size.value)||512
      };

      if(fmt.value === 'svg'){
        const svg = await QRCode.toString(text, { ...opts, type:'svg' });
        preview.innerHTML = svg; // inline SVG
      } else {
        // Canvas bitmap
        preview.innerHTML = '';
        const canvas = document.createElement('canvas');
        preview.appendChild(canvas);
        await QRCode.toCanvas(canvas, text, opts);
      }
    }

    async function downloadQR(){
      const text = content.value.trim();
      if(!text){ alert('è«‹å…ˆè¼¸å…¥å…§å®¹ä¸¦ç”Ÿæˆ QR Code'); return; }
      const baseName = 'qrcode';
      if(lastBlobURL){ URL.revokeObjectURL(lastBlobURL); lastBlobURL = null; }

      if(fmt.value === 'svg'){
        const svgStr = await QRCode.toString(text, { type:'svg', errorCorrectionLevel: ecLevel.value, margin:Number(margin.value)||0, color:{dark:fg.value, light:bg.value}, width:Number(size.value)||512 });
        const blob = new Blob([svgStr], {type:'image/svg+xml'});
        lastBlobURL = URL.createObjectURL(blob);
        triggerDownload(lastBlobURL, baseName + '.svg');
      } else {
        const dataURL = await QRCode.toDataURL(text, { errorCorrectionLevel: ecLevel.value, margin:Number(margin.value)||0, color:{dark:fg.value, light:bg.value}, width:Number(size.value)||512 });
        triggerDownload(dataURL, baseName + '.png');
      }
    }

    function triggerDownload(url, filename){
      const a = document.createElement('a');
      a.href = url; a.download = filename; a.style.display='none';
      document.body.appendChild(a); a.click(); a.remove();
    }

    btnGen.addEventListener('click', renderQR);
    btnDl.addEventListener('click', downloadQR);

    // Auto-generate when parameters change (debounced)
    const debounce = (fn,ms=250)=>{let t;return (...args)=>{clearTimeout(t);t=setTimeout(()=>fn(...args),ms)}};
    [content,ecLevel,size,margin,fmt,fg,bg].forEach(el=>{
      el.addEventListener('input', debounce(renderQR,300));
      el.addEventListener('change', debounce(renderQR,0));
    });
  </script>
</body>
</html>
